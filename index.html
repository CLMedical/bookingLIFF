<!DOCTYPE html>
<html lang="en">

<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Google Fonts - Prompt -->
    <link href='https://fonts.googleapis.com/css?family=Prompt' rel='stylesheet' type='text/css'>

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
    
    <!-- Custom CSS -->
    <link href="style.css" rel="stylesheet" type="text/css" />

    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous" />
    
    <title>นัดพบแพทย์</title>
    
    <!-- jQuery 3.6.0 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous"></script>

    <!-- LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <!-- SweetAlert2 -->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha384-y4X+22IQP7bL9c8A7d9Z71RPB5N2e9p5P8Z/TrAGTkx+F7cO8wMB0n6/z7cE5Q/zRt6ILBz82kFyOZfF7mrhYA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Internal CSS for Font Family -->
    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #d4edda; /* เพิ่มสีพื้นหลังเขียวอ่อน */
        }
    </style>
</head>

<body>
    <div class="mt-4 text-center">
        <div class="justify-content-center align-items-center">
            <h1 class="text-center" style="color: darkgreen;">นัดพบแพทย์</h1>
        </div>
    </div>
    <div id="loginPage" style="display:block;">
        <div id="login-form" class="container-sm fade-in-page mt-4 card-form" style="max-width: 25rem; display:block;">
            <div class="container py-4">
                <div class="form-group mt-3">
                    <form id="loginForm" class="was-validated" autocomplete="off" name="google-sheet">
                        <div class="form-row">
                            <div class="form-group col-md-12 center">
                                <center>
                                    <img id="picURL" class="avatar" alt="profile" width="50" height="50"><br>
                                </center>
                                <div class="mb-3 mt-3">
                                    <input id="uid" class="form-control" name="Uid" style="display:none;">
                                    <img id="upic" name="Upic" width="25%">
                                </div>
                                <div class="form-group col-md-12">
                                    <label for="number1">ชื่อ</label>
                                    <input type="text" class="form-control" placeholder="ชื่อ" id="number1" name="number1" required>
                                </div>
                                <div class="form-group col-md-12">
                                    <label for="number2">นามสกุล</label>
                                    <input type="text" class="form-control" placeholder="นามสกุล" id="number2" name="number2" required>
                                </div>
                                <div class="form-group col-md-12">
                                    <label for="tel">เบอร์โทรติดต่อ</label>
                                    <input type="tel" class="form-control" pattern="[0-9]{10}"
                                        oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1');"
                                        placeholder="ระบุเบอร์โทรศัพท์" id="tel" name="tel" maxlength="10"
                                        minlength="10" required>
                                </div>
                                <div class="form-group col-md-12">
                                    <label for="number4">อาการ</label>
                                    <input type="text" class="form-control" placeholder="อาการ" id="number4" name="number4" required>
                                </div>
                                <div class="form-group col-md-12">
                                    <label for="number5"><i class="bi bi-calendar3"></i>วันที่ต้องการนัด</label>
                                    <input type="date" class="form-control" placeholder="กรุณาเลือกวันที่" id="number5" name="number5" required>
                                </div>
                                <div class="form-group col-md-12">
                                    <label for="number6"><i class="fa-regular fa-clock"></i> เวลา</label>
                                    <select class="form-control" id="number6" name="number6" required>
                                        <option value="" disabled selected>เลือกเวลา</option>
                                        <option value="9:00">9:00</option>
                                        <option value="10:00">10:00</option>
                                        <option value="11:00">11:00</option>
                                    </select>
                                </div>
                                <button type="submit" name="submit" id="submit" class="btn btn-primary bd-indigo-500 btn-block text-white"><i class="fas fa-paper-plane"></i> กดส่งข้อมูล</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        window.onload = function () {
            initializeLiff("1654186914-ZP7PokBX");
        };

        function initializeLiff(myLiffId) {
            liff
                .init({
                    liffId: myLiffId
                })
                .then(() => {
                    getid();
                })
                .catch(err => { console.error(err); });
        }

        function getid() {
            liff.getProfile().then(function (profile) {
                const uid = profile.userId;
                const uname = profile.displayName;
                const upic = profile.pictureUrl;
                document.getElementById("picURL").src = upic;  // แสดงรูป Profile ที่ดึงมา
                document.getElementsByName("Uid")[0].value = uid;
                document.getElementsByName("UName")[0].value = uname;
                document.getElementsByName("Upic")[0].value = upic;
            }).catch(function (error) {
                console.error('Error getting profile:', error);
            });
        }

        const scriptURL = 'https://script.google.com/macros/s/AKfycbwE74WWo7DY8G-igM-Doz_WFqRfWH0hTynQw2J01J9Kf49GvWNLsvV09pAumLeUd9Dg/exec'
        const form = document.forms['google-sheet']

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            Swal.fire({
                title: 'กำลังส่งข้อมูล...',
                text: 'กรุณารอสักครู่',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            fetch(scriptURL, { method: 'POST', body: new FormData(form) })
                .then(response => {
                    if (response.ok) {
                        Swal.close();
                        Swal.fire({
                            icon: 'success',
                            title: 'ลงทะเบียนสำเร็จ!',
                            text: 'ข้อมูลของคุณได้ถูกบันทึกแล้ว',
                            confirmButtonText: 'ตกลง'
                        }).then(() => {
                            form.reset();
                        });
                    } else {
                        throw new Error('Network response was not ok.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.close();
                    Swal.fire({
                        icon: 'error',
                        title: 'เกิดข้อผิดพลาด!',
                        text: 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง',
                        confirmButtonText: 'ตกลง'
                    });
                });
        });

        $(document).ready(function () {
            $('#submit').prop('disabled', true);

            $('#visto').click(function () {
                if ($(this).is(':checked')) {
                    $('#submit').prop('disabled', false);
                } else {
                    $('#submit').prop('disabled', true);
                }
            });
        });

        function closeMe() {
            setTimeout(window.close, 0);
            liff.closeWindow();
        }
    </script>

    <script src="script.js" theme="blue" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
</body>

</html>
