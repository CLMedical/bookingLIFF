<!DOCTYPE html>
<html lang="en">

<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Google Fonts - Prompt -->
    <link href='https://fonts.googleapis.com/css?family=Prompt' rel='stylesheet' type='text/css'>

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
    
    <!-- Custom CSS -->
    <link href="style.css" rel="stylesheet" type="text/css" />

    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
		integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/6a972cf3a7.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400&display=swap" rel="stylesheet">
    
    <title>นัดพบแพทย์</title>
    
    <!-- jQuery 3.6.0 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous"></script>

    <!-- LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <!-- SweetAlert2 -->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha384-y4X+22IQP7bL9c8A7d9Z71RPB5N2e9p5P8Z/TrAGTkx+F7cO8wMB0n6/z7cE5Q/zRt6ILBz82kFyOZfF7mrhYA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Internal CSS for Font Family -->
    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #d4edda; /* เพิ่มสีพื้นหลังเขียวอ่อน */
        }
    </style>
</head>

<body oncontextmenu="return false">
    <div class="mt-4 text-center">
        <div class="justify-content-center align-items-center">
            <!-- -------- ตัวเลขนับถอยหลัง ------ -->
            <!-- <div id="timer"></div> -->
            <h1 class="text-center" style="color: darkgreen;"> <i class="bi bi-hospital"></i>  ระบบจองคิว <br> คลินิกนายแพทย์เฉลิมรัตน์</h1>
           
            <!-- -------- ข้อความแจ้งเตือนด้านล่างของตัวนับ ------ -->
            <!--<div class="mt-1 text-center text-light" id="msgStatus"></div>-->
        </div>
    </div>
    <!-- <section id="cover" style="display:none;"> -->
    <div id="loginPage" style="display:block;">
        <div id="login-form" class="container-sm fade-in-page mt-4 card-form" style="max-width: 25rem; display:block;">
            <div class="container py-1">
                <div class="form-group mt-3">
                    <form id="loginForm" class="was-validated" autocomplete="off" name="google-sheet">
                        <div class="container">
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12 center">
                                <div class="form-row">
                                    <div class="form-group col-md-12">
                                        <center>
                                            <img id="picURL" class="avatar" alt="profile" width="50" height="50"><br>
                                        </center>
                                        <div class="mb-3 mt-3">
                                            <label for="uname" class="form-label">Line-ID</label>
                                            <input type="text" class="form-control" name="UName" id="uname" readonly>
                                            <input id="uid" class="form-control" name="Uid" style="display:none;">
                                            <img id="upic" name="Upic" width="25%">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <label for="number1"> <i class="bi bi-person-lines-fill"></i> ชื่อ</label>
                                        <input type="text" class="form-control" placeholder="ชื่อ" id="number1" name="number1" required>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <label for="number2"> <i class="bi bi-person-lines-fill"></i> นามสกุล</label>
                                        <input type="text" class="form-control" placeholder="นามสกุล" id="number2" name="number2" required>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <label for="tel"><i class="bi bi-telephone-fill"></i> เบอร์โทรติดต่อ</label>
                                        <input type="tel" class="form-control" pattern="[0-9]{10}"
                                            oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1');"
                                            placeholder="ระบุเบอร์โทรศัพท์" id="tel" name="tel" maxlength="10"
                                            minlength="10" required>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <label for="number4"><i class="bi bi-chat-left-dots-fill"></i> อาการ</label>
                                        <input type="text" class="form-control" placeholder="อาการ" id="number4" name="number4" required>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <label for="number5"><i class="bi bi-calendar-plus-fill"></i> วันที่ต้องการนัด</label>
                                        <input type="date" class="form-control" placeholder="กรุณาเลือกวันที่" id="number5" name="number5" required>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <label for="number6"><i class="bi bi-clock-fill"></i> เวลา</label>
                                        <select class="form-control" id="number6" name="number6" required>
                                            <option value="" disabled selected>เลือกเวลา</option>
                                            <option value="09:00">09:00</option>
                                            <option value="09:15">09:15</option>
                                            <option value="09:30">09:30</option>
                                            <option value="09:45">09:45</option>
                                            <option value="10:00">10:00</option>
                                            <option value="10:15">10:15</option>
                                            <option value="10:30">10:30</option>
                                            <option value="10:45">10:45</option>
                                            <option value="11:00">11:00</option>
                                            <option value="11:15">11:15</option>
                                            <option value="11:30">11:30</option>
                                            <option value="11:45">11:45</option>
                                            <option value="12:00">12:00</option>
                                            <option value="12:15">12:15</option>
                                            <option value="12:30">12:30</option>
                                            <option value="12:45">12:45</option>
                                            <option value="13:00">13:00</option>
                                            <option value="13:15">13:15 (เฉพาะวันเสาร์)</option>
                                            <option value="13:30">13:30 (เฉพาะวันเสาร์)</option>
                                            <option value="13:45">13:45 (เฉพาะวันเสาร์)</option>
                                            <option value="14:00">14:00 (เฉพาะวันเสาร์)</option>
                                            <option value="14:15">14:15 (เฉพาะวันเสาร์)</option>
                                            <option value="14:30">14:30 (เฉพาะวันเสาร์)</option>
                                            <option value="14:45">14:45 (เฉพาะวันเสาร์)</option>
                                            <option value="15:00">15:00 (เฉพาะวันเสาร์)</option>
                                            <option value="15:15">15:15 (เฉพาะวันเสาร์)</option>
                                            <option value="15:30">15:30 (เฉพาะวันเสาร์)</option>
                                            <option value="15:45">15:45 (เฉพาะวันเสาร์)</option>
                                            <option value="16:00">16:00 (เฉพาะวันเสาร์)</option>
                                            <option value="16:15">16:15 (เฉพาะวันเสาร์)</option>
                                            <option value="16:30">16:30 (เฉพาะวันเสาร์)</option>
                                            <option value="16:45">16:45 (เฉพาะวันเสาร์)</option>
                                        </select>
                                    </div>
                                    <div class="form-check mb-3">
                                        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
                                        <input type="checkbox" class="form-check-input" name='visto' id='visto' value='' required>
                                        <label class="form-check-label" for="visto">ข้อมูลถูกต้อง</label>
                                        <div class="invalid-feedback">กรุณาทำเครื่องหมายในช่องสี่เหลี่ยม</div>
                                    </div>
                                    <button type="button" name="submit" id="submit" class="btn btn-primary bd-indigo-500 btn-block text-white">
                                        <i class="fa-regular fa-floppy-disk"></i> กดส่งข้อมูล
                                    </button>
                                    <button type="submit" id="confirmSubmit" style="display:none;"></button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        window.onload = function () {
            initializeLiff("1654186914-ZP7PokBX");
        };

        function initializeLiff(myLiffId) {
            liff
                .init({
                    liffId: myLiffId
                })
                .then(() => {
                    getid();
                })
                .catch(err => { });
        }

        function getid() {
            liff.getProfile().then(function (profile) {
                const uid = profile.userId;
                const uname = profile.displayName;
                const upic = profile.pictureUrl;
                document.getElementById("picURL").src = upic;  // แสดงรูป Profile ที่ดึงมา
                document.getElementsByName("Uid")[0].value = uid;
                document.getElementsByName("UName")[0].value = uname;
                document.getElementsByName("Upic")[0].value = upic;
            });
        }


        const scriptURL = 'https://script.google.com/macros/s/AKfycbwE74WWo7DY8G-igM-Doz_WFqRfWH0hTynQw2J01J9Kf49GvWNLsvV09pAumLeUd9Dg/exec'
        const form = document.forms['google-sheet']

        document.getElementById('submit').addEventListener('click', function (e) {
            e.preventDefault();

            Swal.fire({
                title: 'ข้อมูลการจอง',
                html: `
                    <p><strong>ชื่อ:</strong> ${document.getElementById('number1').value}</p>
                    <p><strong>นามสกุล:</strong> ${document.getElementById('number2').value}</p>
                    <p><strong>เบอร์โทรติดต่อ:</strong> ${document.getElementById('tel').value}</p>
                    <p><strong>อาการ:</strong> ${document.getElementById('number4').value}</p>
                    <p><strong>วันที่ต้องการนัด:</strong> ${document.getElementById('number5').value}</p>
                    <p><strong>เวลา:</strong> ${document.getElementById('number6').value} น.</p>
                `,
                showCancelButton: true,
                confirmButtonText: 'บันทึกข้อมูล',
                cancelButtonText: 'แก้ไขข้อมูล'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('confirmSubmit').click();
                }
            });
        });

        document.getElementById('confirmSubmit').addEventListener('click', function (e) {
            e.preventDefault();

            Swal.fire({
                title: 'กำลังส่งข้อมูล...',
                text: 'กรุณารอสักครู่',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            fetch(scriptURL, { method: 'POST', body: new FormData(form) })
                .then(response => {
                    if (response.ok) {
                        Swal.close();
                        Swal.fire({
                            icon: 'success',
                            title: 'จองคิวสำเร็จ!',
                            text: 'กรุณามาก่อนเวลานัดอย่างน้อย 10 นาที ขอบคุณค่ะ',
                            confirmButtonText: 'ตกลง'
                        }).then(() => {
                            form.reset();
                        });
                    } else {
                        throw new Error('Network response was not ok.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.close();
                    Swal.fire({
                        icon: 'error',
                        title: 'เกิดข้อผิดพลาด!',
                        text: 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง',
                        confirmButtonText: 'ตกลง'
                    });
                });
        });

        $(document).ready(function () {
            $('#submit').prop('disabled', true);
            $('#visto').click(function () {
                if ($(this).is(':checked')) {
                    $('#submit').prop('disabled', false);
                } else {
                    $('#submit').prop('disabled', true);
                }
            });
        });

        function validateForm() {
            var telField = document.getElementById("tel");
            var isValid = true;

            if (telField.value.length !== 10 || isNaN(telField.value)) {
                isValid = false;
                $('#submit').prop('disabled', true);
            }

            var submitButton = document.getElementById("submit");
            submitButton.disabled = !isValid;
            return isValid;
        }
    </script>

    <script src="script.js" theme="blue" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
    <!-- โค้ดอื่นในเว็บของคุณ -->

<!-- วางโค้ด popup ที่นี่ -->
<div id="popup">
  <div id="popup-content">
    <h3>📢 เรียนผู้รับบริการ</h3>
    <p>คลินิกหยุดให้บริการวันที่<br><strong><span style="color: red;">14 - 16 เม.ย. 68</span></strong></p>
    <p>ขออภัยในความไม่สะดวก</p>
    <button onclick="closePopup()">ปิด</button>
  </div>
</div>

<script>
  function isInHolidayPeriod() {
    const today = new Date();
    const start = new Date('2025-04-1');
    const end = new Date('2025-04-6');
    start.setHours(0,0,0,0);
    end.setHours(23,59,59,999);
    return today >= start && today <= end;
  }

  window.onload = function() {
    if (isInHolidayPeriod()) {
      document.getElementById("popup").style.display = "block";
    }
  }

  function closePopup() {
    document.getElementById("popup").style.display = "none";
  }
</script>

<style>
  #popup {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 999;
  }
  #popup-content {
    background: white;
    width: 300px;
    margin: 15% auto;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 0 10px #000;
  }
  #popup-content button {
    margin-top: 15px;
    padding: 8px 16px;
    border: none;
    background-color: #007bff;
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }
  #popup-content button:hover {
    background-color: #0056b3;
  }
</style>
<!-- ปิด body -->
</body>
</html>


</body>

</html>
